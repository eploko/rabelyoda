#!/usr/bin/env ruby

require 'rubygems'
require 'fileutils'
require 'term/ansicolor'
require 'tmpdir'
require 'yaml'

include Term::ANSIColor

require 'rabelyoda/options'

# Main block

def main
  $config = RabelYoda::Options.parse
  setup
  print_config
  FileUtils.rm_rf $config['tmp_dir'], :verbose => true
  success "All done!"
end

# Aux methods

def setup
  $config = {}
  $config['tmp_dir'] = File.join Dir.tmpdir, "epl.rabelyoda.#{$$}"
  $config['startwd'] = Dir.getwd
  $config['time_badge'] = Time.now.utc.strftime('%Y%m%d_%H%M')
end

def print_config ; status "CONFIG" ; y $config ; end
def exe(cmd) ; putcmd cmd ; system cmd ; end
def putcmd(cmd) ; print magenta, "CMD: #{cmd}", reset, "\n" ; end
def status(msg) ; print blue, "--- #{msg} ---", reset, "\n" ; end
def success(msg) ; print green, bold, 'SUCCESS: ', msg, reset, "\n" ; end
def error(msg) ; print red, bold, 'ERROR: ', msg, reset, "\n" ; exit 1 ; end
def escape_cmd_args(args) ; args.collect{ |arg| "'#{arg}'"}.join(' ') ; end

# Globbers

main
exit 0
